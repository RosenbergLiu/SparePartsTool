@page "/sale"
@using RestSharp
@inject NavigationManager _navigationManager

<h1>Sale</h1>
@if (Preferences.Default.Get("login", false) == false)
{
    <h3 style="color:red">Login expired</h3>
    <button class="btn btn-primary" onclick="@(()=>GoLogin())">Login</button>
}
else if (Preferences.Default.Get("user", " ") != "Roshan Liu")
{
    <h3>You are not authorized to use this function</h3>
}
else
{
    @if(View == "PartEntry")
    {
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item active" aria-current="page">Parts</li>
            </ol>
        </nav>
        <EditForm class="form-group" Model="@partRecord" OnValidSubmit="Add">
            <div class="input-group">
                <span class="input-group-text">Part Number</span>
                <InputText class="form-control" @bind-Value="partRecord.part" required/>
            </div>
            <br />
            <div class="input-group">
                <span class="input-group-text">Quantity</span>
                <InputText class="form-control" type="number" @bind-Value="partRecord.qty" required />
                <div class="col">
                @if (spiner)
                {
                    <div class="text-center">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                }
                </div>
                <div class="col">
                    <button class="btn btn-primary form-control">Add</button>
                </div>
            </div>
        </EditForm>

        <p style="color:red">@AddMessage</p>
        <br/>
        <div id="datatable">
            <table class="table table-success table-striped table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Part Number</th>
                        <th>Quantity</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Record item in PartList)
                    {
                        <tr>
                            <td>
                                <a class="btn btn-sm">@item.Number</a>
                            </td>
                            <td>
                                <a class="btn btn-sm">@item.Quantity</a>
                            </td>
                            <td>
                                <a class="btn btn-sm">@item.Name</a>
                            </td>
                            <td>
                                <a class="btn btn-sm">@item.Price</a>
                            </td>
                            <td style="text-align:center;">
                                <a class="btn btn-sm btn-danger" onclick="@(()=>Delete(item.Number))">Delete</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <p class="text-end">Total: @Total</p>

        <button class="btn btn-primary float-end" onclick="@(()=>GoTo("CustomerEntry"))">Next</button>
        
    }
    @if(View == "CustomerEntry")
    {
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a onclick="@(()=>GoTo("PartEntry"))">Parts</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Customer Info</li>
            </ol>
        </nav>
        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" onclick="@(()=>SetType("CounterSale"))" checked  />
            <label class="btn btn-outline-primary" for="btnradio1">Counter Sale</label>

            <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" onclick="@(()=>SetType("Delivery"))"/>
            <label class="btn btn-outline-primary" for="btnradio2">Delivery</label>

            <input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio3">FOC</label>
        </div>
        <br />
        <br />
        ////////CounterSale////////
        @if (Type == "CounterSale")
        {
            <EditForm class="form-group" Model="@customerInfo" OnValidSubmit="Submit">
                <div class="mb-3">
                    <label for="CusName" class="form-label">Name on invoice</label>
                    <input class="form-control" id="CusName" @bind-value="customerInfo.Name" required/>
                </div>
                <div class="mb-3">
                    <label for="CusPhone" class="form-label">Phone number</label>
                    <input class="form-control" id="CusPhone" @bind-value="customerInfo.Phone" />
                </div>
                <button class="btn btn-primary form-control">Submit</button>
            </EditForm>
            @if (bar)
            {
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                </div>
            }
        }
        ////////Delivery////////
        @if(Type == "Delivery")
        {
            <EditForm class="form-group" Model="@customerInfo" OnValidSubmit="Submit">
                <div class="mb-3">
                    <label for="CusName" class="form-label">Name on invoice</label>
                    <input class="form-control" id="CusName" @bind-value="customerInfo.Name" required>
                </div>
                <div class="mb-3">
                    <label for="CusPhone" class="form-label">Phone number</label>
                    <input class="form-control" id="CusPhone" @bind-value="customerInfo.Phone"/>
                </div>
                <div class="mb-3">
                    <label for="CusStreet" class="form-label">Street</label>
                    <input class="form-control" id="CusStreet" @bind-value="customerInfo.Street" />
                </div>





                <button class="btn btn-primary form-control">Submit</button>
            </EditForm>
        }
        ///
        @if(Type == "FOC")
        {
            
        }

        <button class="btn btn-primary" onclick="@(()=>GoTo("PartEntry"))">Back</button>
        <button class="btn btn-primary float-end" onclick="@(()=>GoTo("Payment"))">Next</button>
    }
    @if(View == "Payment")
    {
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a onclick="@(()=>GoTo("PartEntry"))">Parts</a>
                </li>
                <li class="breadcrumb-item">
                    <a onclick="@(()=>GoTo("CustomerEntry"))">Customer Info</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Payment</li>
            </ol>
        </nav>
        <button class="btn btn-primary" onclick="@(()=>GoTo("CustomerEntry"))">Back</button>
    }
    @CusMessage
}
@code{
    public bool bar { get; set; } = false;
    public string View { get; set; } = "PartEntry";
    public double Total { get; set; } = 0;
    public string CusMessage { get; set; } = " ";
    public bool spiner { get; set; } = false;
    public string Cookie = Preferences.Default.Get("cookie", "");
    public List<Record> PartList = new();
    public string Type { get; set; } = "CounterSale";
    public string AddMessage { get; set; } = " ";
    public class PartRecord
    {
        public string part { get; set; }
        public string qty { get; set; } = "1";
    }
    public class CustomerInfo
    {
        public string Name{ get; set; }
        public string City{ get; set; }
        public string Street{ get; set; }
        public string Phone { get; set; }
        public string PostCode{ get; set; }
        public string State { get; set; }
    }
    public class Result
    {
        public string number { get; set; }
        public string stock { get; set; }
        public string name { get; set; }
        public string price { get; set; }
    }

    public class Record
    {
        public string Number { get; set; }
        public int Quantity { get; set; }
        public string Name { get; set; }
        public double Price { get; set; }
    }

    public CustomerInfo customerInfo = new();
    public PartRecord partRecord = new();
    public Result result = new();
    private void GoLogin()
    {
        _navigationManager.NavigateTo("");
    }

    private void GoTo(string page)
    {
        View = page;
    }
    public void Delete(string partNumber)
    {
        foreach(var r in PartList)
        {
            if (r.Number == partNumber)
            {
                PartList.Remove(r);
                StateHasChanged();
                return;
            }
        }
    }

    private void SetType(string type)
    {
        Type = type;
    }


    private async Task Add()
    {
        spiner = true;
        AddMessage = " ";

        //Validate that qty cannot be 0
        if (partRecord.qty == "0")
        {
            AddMessage = $"* Invalid quantity";
            await Task.CompletedTask;
            spiner = false;
            partRecord = new();
            return;
        }
        //Validate if part already added
        foreach(Record r in PartList)
        {
            if (r.Number == partRecord.part)
            {
                AddMessage = $"* {partRecord.part} already exists";
                await Task.CompletedTask;
                spiner = false;
                partRecord = new();
                return;
            }
        }

        var client = new RestClient("https://partners.gorenje.com/sagcc/se_pregled_alternativ_nov.aspx");
        var request = new RestRequest("https://partners.gorenje.com/sagcc/se_pregled_alternativ_nov.aspx", Method.Post);
        request.AddHeader("Cookie", Cookie);
        request.AddHeader("sec-ch-ua", "\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Google Chrome\";v=\"108\"");
        request.AddHeader("sec-ch-ua-mobile", "?0");
        request.AddHeader("sec-ch-ua-platform", "\"Windows\"");
        request.AddHeader("Upgrade-Insecure-Requests", "1");
        request.AddHeader("Content-Type", "application/x-www-form-urlencoded");
        request.AddHeader("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9");
        request.AddHeader("host", "partners.gorenje.com");
        request.AddParameter("DXCss", "0_2550,1_68,0_2555,1_210,0_2443,1_209,0_2448,0_2455,0_2459");
        request.AddParameter("DXScript", "1_11,1_12,1_252,1_23,1_64,1_13,1_14,1_15,1_35,1_183,1_184,1_21,1_22,1_190,1_17,1_186,1_193,1_41,1_19,1_213,1_224,1_225,1_211,1_227,1_236,1_238,1_239,1_230,1_234,1_240,1_39");
        request.AddParameter("__EVENTARGUMENT", "");
        request.AddParameter("__EVENTTARGET", "ctl00$ContentPlaceHolder1$tbMat");
        request.AddParameter("__LASTFOCUS", "");
        request.AddParameter("__VIEWSTATE", "/wEPDwUJODAyNDE4MzY0D2QWAmYPZBYCAgMPZBYIAgUPPCsACQIADxYCHg5fIVVzZVZpZXdTdGF0ZWdkBg9kEBYSZgIBAgICAwIEAgUCBgIHAggCCQIKAgsCDAINAg4CDwIQAhEWEjwrAAsCABYIHgRUZXh0BQNTQUceBE5hbWUFA1NBRx4IRXhwYW5kZWRnHg5SdW50aW1lQ3JlYXRlZGcBD2QQFgNmAgECAhYDFCsAAhYGHwEFEFVzZXI6IFJvc2hhbiBMaXUeFUNsaWVudEVuYWJsZWRJbnRlcm5hbGgfBGdkFCsAAhYGHgtOYXZpZ2F0ZVVybAUMc3JlZGluYS5hc3B4HwEFBEhvbWUfBGdkFCsAAhYGHwYFC2xvZ291dC5hc3B4HwEFB0xvZyBvZmYfBGdkZDwrAAsCABYIHwEFC0NhbGwgQ2VudGVyHwIFATIfA2cfBGcBD2QQFgNmAgECAhYDFCsAAhYGHwYFFGNhbGxjZW50ZXJfdm5vcy5hc3B4HwEFC0VudGVyIGNsYWltHwRnZBQrAAIWBh8GBRhjYWxsY2VudGVyX3ByZWdsZWQxLmFzcHgfAQUQUmV2aWV3IG9mIGNsYWltcx8EZ2QUKwACFgYfBgUsc2VfcG90cmRpX3Jla2xhbWFjaWplLmFzcHg/ZGVsaXZlcnlpbnN0YWxsPTEfAQUeUmVxdWVzdCBmb3IgZGVsaXZlcnkgLyBpbnN0YWxsHwRnZGQ8KwALAgAWCB8BBQ5TZXJ2aWNlIG9yZGVycx8CBQEzHwNnHwRnAQ9kEBYFZgIBAgICAwIEFgUUKwACFgYfBgUTcG90bmlfcHJlZ2xlZDEuYXNweB8BBRxSZXZpZXcgY2xpZW50cyBpbiB0aGUgYmFza2V0HwRnZBQrAAIWBh8GBRlzZV9wcmdfemFrbGp1Y2V2YW5qZS5hc3B4HwEFIENvbXBsZXRpbmcgb2YgYWdyZWVkIHdvcmsgb3JkZXJzHwRnZBQrAAIWBh8GBSBzZV9kbmV2bm9femFrbGp1Y2VuaV9uYWxvZ2kuYXNweB8BBS1EYWlseSByZXR1cm4gZGVsaXZlcnkgLyBDbG9zZWQgd29ya2luZyBvcmRlcnMfBGdkFCsAAhYGHwYFHHNlX25lcmF6cG9yZWplbmlfbmFsb2dpLmFzcHgfAQUZV29yayBvcmRlcnMgb3V0IG9mIGJhc2tldB8EZ2QUKwACFgYfBgUTcG90bmlfa3JlaXJhajEuYXNweB8BBRtNYW51YWwgYWxsb2NhdGlvbiBvZiBvcmRlcnMfBGdkZDwrAAsCABYIHwEFBVNhbGVzHwIFATkfA2gfBGcBD2QQFgNmAgECAhYDFCsAAhYGHwYFFXNlX3Byb2RhamFfcmRfYXUuYXNweB8BBRBTcGFyZSBwYXJ0cyBzYWxlHwRnZBQrAAIWBh8GBRZzZV9wcm9kYWphX3JkX3ByZy5hc3B4HwEFDVNhbGVzIHByZXZpZXcfBGdkFCsAAhYGHwYFGnNlX2JsYWdham5hX3pha2xqdWNlay5hc3B4HwEFFkNvbXBsZXRpb24gb2YgdGhlIHNhbGUfBGdkZDwrAAsCABYIHwEFCUNhc2ggZGVzax8CBQIxMx8DaB8EZwEPZBAWBmYCAQICAgMCBAIFFgYUKwACFgYfBgUXc2VfYmxhZ2FqbmFfc3RhbmplLmFzcHgfAQUNU3RhdGUgb2YgY2FzaB8EZ2QUKwACFgYfBgUXc2VfYmxhZ2FqbmFfa25qaWdhLmFzcHgfAQUJQ2FzaCBib29rHwRnZBQrAAIWBh8GBRlzZV9ibGFnYWpuYV9wcmVqZW1raS5hc3B4HwEFC0Nhc2ggaW5jb21lHwRnZBQrAAIWBh8GBRhzZV9ibGFnYWpuYV9pemRhdGtpLmFzcHgfAQURQ2FzaCBkaXNidXJzZW1lbnQfBGdkFCsAAhYGHwYFG3NlX2JsYWdham5hX2l6ZHByZV9wcmcuYXNweB8BBRpSZXZpZXcgb2YgRXhwZW5jZXMvSW5jb21lcx8EZ2QUKwACFgYfBgUSc2VfcmVwb3J0X29zcy5hc3B4HwEFEERpc3BsYXkgb2YgT1NTJ3MfBGdkZDwrAAsCABYIHwEFC1N1cGVydmlzaW9uHwIFAjE0HwNoHwRnAQ9kEBYGZgIBAgICAwIEAgUWBhQrAAIWBh8GBRZzZV9uYWR6b3JfcHJvZGFqYS5hc3B4HwEFDVNhbGVzIHByZXZpZXcfBGdkFCsAAhYGHwYFFXNlX25hZHpvcl9pemRwcmUuYXNweB8BBRpSZXZpZXcgb2YgRXhwZW5jZXMvSW5jb21lcx8EZ2QUKwACFgYfBgUVc2VfbmFkem9yX2tuamlnYS5hc3B4HwEFCUNhc2ggYm9vax8EZ2QUKwACFgYfBgUVc2VfbmFkem9yX3N0YW5qZS5hc3B4HwEFDVN0YXRlIG9mIGNhc2gfBGdkFCsAAhYGHwYFF3NlX25hZHpvcl9ibGFnYWpuYS5hc3B4HwEFBlJlcG9ydB8EZ2QUKwACFgYfBgUWc2VfcmVwb3J0X29zcy5hc3B4P249MR8BBRBEaXNwbGF5IG9mIE9TUydzHwRnZGQ8KwALAgAWCB8BBQVTdG9jax8CBQIyMh8DZx8EZwEPZBAWCWYCAQICAgMCBAIFAgYCBwIIFgkUKwACFgYfBgUUemFsb2dhX3NlcnZpc2VyLmFzcHgfAQUSVGVjaG5pY2lhbidzIHN0b2NrHwRnZBQrAAIWBh8GBRdwcmVnbGVkX3phb3N0YW5rb3YuYXNweB8BBRxSZXZpZXcgbWF0ZXJpYWwgcmVzZXJ2YXRpb25zHwRnZBQrAAIWBh8GBRVwcmVnbGVkemFsb2dhbm92LmFzcHgfAQUWUHJldmlldyBvZiBzdG9jayAtIE5FVx8EZ2QUKwACFgYfBgUYc2VfaXpkYWphX21hdGVyaWFsYS5hc3B4HwEFGFJldmlldyBvZiBtYXRlcmlhbCBpc3N1ZR8EZ2QUKwACFgYfBgUZc2VfcHJldnplbV9tYXRlcmlhbGEuYXNweB8BBR5SZXZpZXcgb2YgbWF0ZXJpYWwgdGFraW5nIG92ZXIfBGdkFCsAAhYGHwYFGXNlX2dpYmFuamVfbWF0ZXJpYWxhLmFzcHgfAQUUTWF0ZXJpYWwgZmxvdyByZXZpZXcfBGdkFCsAAhYGHwYFE3BvcHJhdmFfemFsb2dlLmFzcHgfAQUTQ29ycmVjdGlvbiBvZiBTdG9jax8EZ2QUKwACFgYfBgUWc2VfemFsb2dlX3NhZ19zYXAuYXNweB8BBRtTdG9jayBjb21wYXJpc29uICBTQUcgLSBTQVAfBGdkFCsAAhYGHwYFC3phbG9nYS5hc3B4HwEFBVN0b2NrHwRnZGQ8KwALAgAWCB8BBRJSZXR1cm5pbmcgbWF0ZXJpYWwfAgUCMjMfA2gfBGcBD2QQFgJmAgEWAhQrAAIWBh8GBRF2cmFjaWxvX3Zub3MuYXNweB8BBQ9SZXR1cm4gbWF0ZXJpYWwfBGdkFCsAAhYGHwYFHnZyYWNpbG9fcHJlZ2xlZF9wb3RyZGl0ZXYuYXNweB8BBRFSZXR1cm5pbmdzIHJldmlldx8EZ2RkPCsACwIAFggfAQUJSW52ZW50b3J5HwIFAjI0HwNnHwRnAQ9kEBYCZgIBFgIUKwACFgYfBgUTaW52ZW50dXJhX3Zub3MuYXNweB8BBQlJbnZlbnRvcnkfBGdkFCsAAhYGHwYFE3ByaW1lcmphdmFfaW52LmFzcHgfAQUYSW52ZW50b3J5IFJldmlldy9Db21wYXJlHwRnZGQ8KwALAgAWCB8BBQZPcmRlcnMfAgUCMjUfA2cfBGcBD2QQFgJmAgEWAhQrAAIWBh8GBRRwcmVnbGVkX25hcm9jaWwuYXNweB8BBR5SZXZpZXcgb3JkZXJzLCBtYW51YWwgb3JkZXJpbmcfBGdkFCsAAhYGHwYFD3NlX3ByZXZ6ZW0uYXNweB8BBSFDb25maXJtYXRpb24gb2YgcmVjaWV2ZWQgbWF0ZXJpYWwfBGdkZDwrAAsCABYIHwEFBFNldHMfAgUCMjYfA2cfBGcBD2QQFgZmAgECAgIDAgQCBRYGFCsAAhYGHwYFG3ByZWdsZWRfc2V0X3BsYW5pcmFuamUuYXNweB8BBRpSZXZpZXcgb2Ygc3BhcmUgcGFydHMgc2V0cx8EZ2QUKwACFgYfBgUXc2Vfc2V0aV9zZXJ2aXNlcmppLmFzcHgfAQUcVHJpZ2dlciBwb2ludHMgLSBUZWNobmljaWFucx8EZ2QUKwACFgYfBgUUc2Vfc2V0aV90ZWhuaWthLmFzcHgfAQUiVHJpZ2dlciBwb2ludHMgLSBTZXJ2aWNlIHRlY2huaXF1ZR8EZ2QUKwACFgYfBgUVc2Vfc2V0aV9zZXR0aW5ncy5hc3B4HwEFIVVwZGF0aW5nIG9yZGVycyBzY2hlZHVsZSBzZXR0aW5ncx8EZ2QUKwACFgYfBgUbc2Vfc2V0aV9vYnZlc2NhbmplX21uZy5hc3B4HwEFIkpvYiBvcmRlciBpbXBsZW1lbnRhdGlvbiBpbmZvcm1pbmcfBGdkFCsAAhYGHwYFGHNlX3NlcnZpc2VyX2Nhcl9iaW4uYXNweB8BBRpWZWhpY2xlcyBzdG9yYWdlIGxvY2F0aW9ucx8EZ2RkPCsACwIAFggfAQUXU3RvY2sgVHJhbnNmZXIgUmVjZWlwdHMfAgUCMjcfA2cfBGcBD2QQFgJmAgEWAhQrAAIWBh8GBRFtZWRfc2tsX3Zub3MuYXNweB8BBR1DcmVhdGUgU3RvY2sgVHJhbnNmZXIgUmVjZWlwdB8EZ2QUKwACFgYfBgUUbWVkX3NrbF9wcmVnbGVkLmFzcHgfAQUeU3RvY2sgVHJhbnNmZXIgcmVjZWlwdHMgcmV2aWV3HwRnZGQ8KwALAgAWCB8BBRZTcGFyZSBwYXJ0cyBwcmljZSBsaXN0HwIFAjI4HwNnHwRnAQ9kEBYDZgIBAgIWAxQrAAIWBh8GBQ1zZV9jZW5pay5hc3B4HwEFFlNwYXJlIHBhcnRzIHByaWNlIGxpc3QfBGdkFCsAAhYGHwYFGnNlX3ByZWdsZWRfYWx0ZXJuYXRpdi5hc3B4HwEFGE92ZXJ2aWV3IG9mIGFsdGVybmF0aXZlcx8EZ2QUKwACFggfBgUec2VfcHJlZ2xlZF9hbHRlcm5hdGl2X25vdi5hc3B4HwEFIE92ZXJ2aWV3IG9mIGFsdGVybmF0aXZlcyAtIFN0b2NrHwRnHghTZWxlY3RlZGdkZDwrAAsCABYIHwEFDkFkbWluaXN0cmF0aW9uHwIFAjMyHwNoHwRnAQ9kEBYBZhYBFCsAAhYGHwYFFGNoYW5nZV9wYXNzd29yZC5hc3B4HwEFD0NoYW5nZSBwYXNzd29yZB8EZ2RkPCsACwIAFggfAQUHUmVwb3J0cx8CBQIzMx8DaB8EZwEPZBAWA2YCAQICFgMUKwACFgYfBgUhc2VfcmVwb3J0X3pha2xqdWNlbmlfbmFsb2dpMS5hc3B4HwEFF1JldmlldyBvZiBjbG9zZWQgb3JkZXJzHwRnZBQrAAIWBh8GBRRzZV9vc3NfbmFyb2NpbGEuYXNweB8BBSNSZXZpZXcgc3RvY2tzIG9mIG1hdGVyaWFscyBmcm9tIE9TUx8EZ2QUKwACFgYfBgUgc2VfcmVwb3J0X2NsYWltc19mb3JfZGVhbGVyLmFzcHgfAQUYQ2xhaW1zIGV4cG9ydCBmb3IgZGVhbGVyHwRnZGQ8KwALAgAWCB8BBQRIZWxwHwIFAjM1HwNoHwRnAQ9kEBYBZhYBFCsAAhYGHwYFCnBvbW9jLmFzcHgfAQUESGVscB8EZ2RkPCsACwIAFggfAQUDR0FTHwIFAjM4HwNnHwRnAQ9kEBYBZhYBFCsAAhYGHwYFD2dhc19yZXBvcnQu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ayBpbiBDLlcuIChTTE8pHw4CCgs8KwAFAQAWBh8PAv////8PHxAC/////w8fEQsrBAA8KwAMAgAWBB4KQ29sVmlzaWJsZWgfDgILCzwrAAUBABYGHw8C/////w8fEAL/////Dx8RCysEAA8WDAIBAgECAQIBAgECAQIBAgECAQIBAgECARYBBX9EZXZFeHByZXNzLldlYi5HcmlkVmlld0RhdGFUZXh0Q29sdW1uLCBEZXZFeHByZXNzLldlYi52MjEuMiwgVmVyc2lvbj0yMS4yLjMuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iODhkMTc1NGQ3MDBlNDlhCTwrAAgBBxQrAAIWAh8BBR9QYWdlIHswfSBmcm9tIHsxfSAoezJ9IHJlc3VsdHMpZA0UKwABFgQeCkdyb3VwUGFuZWwFMURyYWcgYSBjb2x1bW4gaGVhZGVyIGhlcmUgdG8gZ3JvdXAgYnkgdGhhdCBjb2x1bW4eDERhdGFFbXB0eVJvdwUSTm8gZGF0YSB0byBkaXNwbGF5GDwrAAcBBRQrAAJkZGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgQFDWN0bDAwJHNhZ01lbnUFFGN0bDAwJGNiSmV6aWtBcGwkREREBSJjdGwwMCRDb250ZW50UGxhY2VIb2xkZXIxJGltZ0V4Y2VsBSdjdGwwMCRDb250ZW50UGxhY2VIb2xkZXIxJEFTUHhHcmlkVmlldzGtQUjHnOt0UJdPifc5dQJqX/WDEtk7Lc+a/fNvckV/wg==");
        request.AddParameter("__VIEWSTATEGENERATOR", "597CC0DF");
        request.AddParameter("ctl00$ContentPlaceHolder1$ASPxGridView1", "{&quot;keys&quot;:[],&quot;callbackState&quot;:&quot;BwUHAwIERGF0YQcnAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcAAgtGb3JtYXRTdGF0ZQcAAgVTdGF0ZQYsAQcMBwACAQcBAgEHAgIBBwMCAQcEAgEHBQIBBwYCAQcHAgEHCAIBBwkCAQcKAgEHCwIABwEHAgcBBwAHAAcABwAHDAcABv//BwEG//8HAgb//wcDBv//BwQG//8HBQb//wcGBv//BwcG//8HCAb//wcJBv//BwoG//8HCwb//wIABQAAAIAJAghtYXRlcmlhbAcACQIAAgADB34AXFN5c3RlbS5TdHJpbmdbXSwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5AgABAAAA/////wEAAAAAAAAAEQEAAAAAAAAACwIABwACAQcABwACAAIBBwAHAAcABwAHAAIIUGFnZVNpemUDBzICGlByZXZSZXF1ZXN0VmlzaWJsZVJvd0NvdW50AwcA&quot;,&quot;groupLevelState&quot;:{},&quot;selection&quot;:&quot;&quot;,&quot;toolbar&quot;:null}");
        request.AddParameter("ctl00$ContentPlaceHolder1$btnPrikazi", "Show");
        request.AddParameter("ctl00$ContentPlaceHolder1$tbMat", partRecord.part);
        request.AddParameter("ctl00$cbJezikApl", "English");
        request.AddParameter("ctl00$cbJezikApl$DDD$L", "EN");
        request.AddParameter("ctl00$cbJezikApl$DDD$L$State", "{&quot;CustomCallback&quot;:&quot;&quot;}");
        request.AddParameter("ctl00$cbJezikApl$DDDState", "{&quot;windowsState&quot;:&quot;0:0:-1:0:0:0:-10000:-10000:1:0:0:0&quot;}");
        request.AddParameter("ctl00$sagMenu", "{&quot;selectedItemIndexPath&quot;:&quot;12i2&quot;,&quot;groupsExpanding&quot;:&quot;1;1;1;0;0;0;1;0;1;1;1;1;1;0;0;0;1;1&quot;}");
        request.AddParameter("ctl00$tbOss", "");
        request.AddParameter("ctl00_cbJezikApl_VI", "EN");
        var response = await client.ExecuteAsync(request);
        string html = response.Content;
        var dataResult = html.Split("</td><td class=\"dxgv\">");
        if (dataResult.Length > 1)
        {
            ////found
            var dataSet = dataResult[3].Split("</td><td class=\"dxgv\" align=\"right\">");

            result.number = dataResult[1].Substring(12);
            result.stock = dataSet[0];
            result.price = dataSet[2];
            result.name = dataResult[2];

            int stock = int.Parse(dataSet[0]);
            int addQty = int.Parse(partRecord.qty);


            if (stock < addQty)
            {
                AddMessage = $"{result.number} x {partRecord.qty} is not in stock";

            }
            else
            {
                Record record = new()
                    {
                        Number = result.number,
                        Quantity = 1,
                        Name = result.name,
                        Price = double.Parse(result.price)
                    };
                PartList.Add(record);
            }

        }
        if (dataResult.Length == 1)
        {
            ////wrong result
            AddMessage = "* Part number not exist";
        }

        if (html.Split("Overview of alternatives").Length == 1)
        {
            Preferences.Default.Set("login", false);
            Preferences.Default.Set("user", "");
        }
        await Task.CompletedTask;
        spiner = false;
        partRecord = new();
    }





    private async Task Submit()
    {
        bar = true;
        CusMessage = customerInfo.Name;

        ///////////Create Order
        var client = new RestClient("https://partners.gorenje.com/sagCC/se_prodaja_rd_au.aspx");
        var request = new RestRequest("https://partners.gorenje.com/sagCC/se_prodaja_rd_au.aspx",Method.Get);
        request.AddHeader("sec-ch-ua", "\"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"108\", \"Google Chrome\";v=\"108\"");
        request.AddHeader("sec-ch-ua-mobile", "?0");
        request.AddHeader("sec-ch-ua-platform", "\"Windows\"");
        request.AddHeader("Upgrade-Insecure-Requests", "1");
        request.AddHeader("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9");
        request.AddHeader("host", "partners.gorenje.com");
        request.AddHeader("cookie", "time_zone_offset=660; time_zone_has_dst=1; time_zone_is_dst=1; time_zone_base_offset=600; country_code=036; ai_user=L0igm|2022-08-26T00:02:12.161Z; potni_kreiraj1_aspx_ctl00_ContentPlaceHolder1_ASPxGridView1=page1|hierarchy20|0|-1|1|-1|2|-1|3|-1|4|-1|5|-1|6|-1|7|-1|8|-1|9|-1|10|-1|11|-1|12|-1|13|-1|14|-1|15|-1|16|-1|17|-1|18|-1|19|-1|visible20|t0|t1|t2|t3|t4|t5|t6|t7|t8|t9|t10|t11|t12|t13|t14|f17|t15|t16|t18|t19|width20|e|e|e|e|e|e|e|e|e|e|e|e|e|e|e|e|e|e|e|e; SAGMenu=1;1;1;1;0;0;0;1;1;0;1;1;1;0;0;0;1;1; ASP.NET_SessionId=wuiuq3rc50gokviyjkrarv2s; .sagAuth=ED30709BADDD0E98259B4DF046DC8B976DCD572FD97198CB8C3D70D29EA1CAC999D099321E9CAC8D43DD53E8B9C8139A3281FCB0A1943B4E048F25B3F79092359935898DD1B548B811CC2563B5CEF03F70CA772B89E292D33768D1D62CC0A89A33A3F0C28005359CBD90698C8A2FD2D95A289E76280E2145617FF44351C1A3C740314FBF9B3E8025A162F3541ECAEE17; ai_session=fU1+g|1674430203787.2|1674430203787.2; SAGMenu=1%3b1%3b1%3b1%3b0%3b0%3b0%3b0%3b0%3b0%3b0%3b0%3b0%3b0%3b0%3b0%3b1%3b1");
        var response = await client.ExecuteAsync(request);
        string html = response.Content;
        if (html.Split("SPARE PARTS SALE").Length == 1)
        {
            Preferences.Default.Set("login", false);
            Preferences.Default.Set("user", "");

        }
        //string ViewState = html.Split("__VIEWSTATE\" id = \"__VIEWSTATE\" value = \"")[1];
        //CusMessage = ViewState;

        bar = false;

    }
}